# API Î¨∏ÏÑú

SMG Kafka ÌîÑÎ°úÏ†ùÌä∏Ïùò REST API ÏÇ¨Ïö©Î≤ïÏùÑ ÏÑ§Î™ÖÌï©ÎãàÎã§.

## üìã Í∏∞Î≥∏ Ï†ïÎ≥¥

- **Base URL**: `http://localhost:3000`
- **Content-Type**: `application/json`
- **Authentication**: ÌòÑÏû¨ ÎØ∏Íµ¨ÌòÑ (ÌïÑÏöîÏãú Ï∂îÍ∞Ä Í∞ÄÎä•)

## üîç Health Check

### GET /health

ÏÑúÎ≤Ñ ÏÉÅÌÉúÎ•º ÌôïÏù∏Ìï©ÎãàÎã§.

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"status\": \"healthy\",
  \"timestamp\": \"2024-01-15T10:30:00.000Z\",
  \"uptime\": 3600.123,
  \"version\": \"1.0.0\"
}
```

## üì® Î©îÏãúÏßÄ API

### GET /api/messages

Ï†ÄÏû•Îêú Kafka Î©îÏãúÏßÄÎ•º Ï°∞ÌöåÌï©ÎãàÎã§.

**Query Parameters:**
- `topic` (string, optional): ÌäπÏ†ï ÌÜ†ÌîΩ ÌïÑÌÑ∞ÎßÅ
- `limit` (number, optional, default: 100): Ï°∞ÌöåÌï† Î©îÏãúÏßÄ Ïàò
- `offset` (number, optional, default: 0): ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïò§ÌîÑÏÖã
- `startDate` (string, optional): ÏãúÏûë ÎÇ†Ïßú (ISO 8601)
- `endDate` (string, optional): Ï¢ÖÎ£å ÎÇ†Ïßú (ISO 8601)

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/messages?topic=user-activities&limit=50&offset=0\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"data\": [
    {
      \"id\": \"uuid-string\",
      \"topic\": \"user-activities\",
      \"partition\": 0,
      \"offset\": \"12345\",
      \"key\": \"user-001\",
      \"value\": {
        \"userId\": \"user-001\",
        \"action\": \"login\",
        \"timestamp\": \"2024-01-15T10:30:00.000Z\"
      },
      \"timestamp\": \"2024-01-15T10:30:00.000Z\",
      \"createdAt\": \"2024-01-15T10:30:01.000Z\"
    }
  ],
  \"pagination\": {
    \"total\": 500,
    \"limit\": 50,
    \"offset\": 0,
    \"hasMore\": true
  }
}
```

## üë§ ÏÇ¨Ïö©Ïûê ÌôúÎèô API

### GET /api/user-activities

ÏÇ¨Ïö©Ïûê ÌôúÎèô Î°úÍ∑∏Î•º Ï°∞ÌöåÌï©ÎãàÎã§.

**Query Parameters:**
- `userId` (string, optional): ÌäπÏ†ï ÏÇ¨Ïö©Ïûê ÌïÑÌÑ∞ÎßÅ
- `action` (string, optional): ÌäπÏ†ï Ïï°ÏÖò ÌïÑÌÑ∞ÎßÅ
- `limit` (number, optional, default: 100): Ï°∞ÌöåÌï† Îç∞Ïù¥ÌÑ∞ Ïàò
- `offset` (number, optional, default: 0): ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïò§ÌîÑÏÖã
- `startDate` (string, optional): ÏãúÏûë ÎÇ†Ïßú
- `endDate` (string, optional): Ï¢ÖÎ£å ÎÇ†Ïßú

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/user-activities?userId=user-001&action=login\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"data\": [
    {
      \"id\": \"uuid-string\",
      \"userId\": \"user-001\",
      \"action\": \"login\",
      \"resource\": \"/dashboard\",
      \"metadata\": {
        \"browser\": \"Chrome\",
        \"version\": \"120.0\"
      },
      \"ipAddress\": \"192.168.1.100\",
      \"userAgent\": \"Mozilla/5.0...\",
      \"timestamp\": \"2024-01-15T10:30:00.000Z\",
      \"createdAt\": \"2024-01-15T10:30:01.000Z\"
    }
  ],
  \"pagination\": {
    \"total\": 150,
    \"limit\": 100,
    \"offset\": 0,
    \"hasMore\": true
  }
}
```

### POST /api/produce/user-activity

ÏÇ¨Ïö©Ïûê ÌôúÎèôÏùÑ KafkaÎ°ú Ï†ÑÏÜ°Ìï©ÎãàÎã§.

**Request Body:**
```json
{
  \"userId\": \"user-001\",
  \"action\": \"login\",
  \"resource\": \"/dashboard\",
  \"metadata\": {
    \"browser\": \"Chrome\",
    \"version\": \"120.0\"
  },
  \"ipAddress\": \"192.168.1.100\",
  \"userAgent\": \"Mozilla/5.0...\"
}
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"success\": true,
  \"message\": \"User activity sent to Kafka\"
}
```

## üìä ÏãúÏä§ÌÖú Î©îÌä∏Î¶≠ API

### GET /api/metrics

ÏãúÏä§ÌÖú Î©îÌä∏Î¶≠ÏùÑ Ï°∞ÌöåÌï©ÎãàÎã§.

**Query Parameters:**
- `metricName` (string, optional): ÌäπÏ†ï Î©îÌä∏Î¶≠ ÌïÑÌÑ∞ÎßÅ
- `limit` (number, optional, default: 100): Ï°∞ÌöåÌï† Îç∞Ïù¥ÌÑ∞ Ïàò
- `offset` (number, optional, default: 0): ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïò§ÌîÑÏÖã
- `startDate` (string, optional): ÏãúÏûë ÎÇ†Ïßú
- `endDate` (string, optional): Ï¢ÖÎ£å ÎÇ†Ïßú

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/metrics?metricName=cpu_usage&limit=100\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"data\": [
    {
      \"id\": \"uuid-string\",
      \"metricName\": \"cpu_usage\",
      \"value\": 75.5,
      \"unit\": \"percentage\",
      \"tags\": {
        \"server\": \"web-01\",
        \"environment\": \"production\"
      },
      \"timestamp\": \"2024-01-15T10:30:00.000Z\",
      \"createdAt\": \"2024-01-15T10:30:01.000Z\"
    }
  ],
  \"pagination\": {
    \"total\": 1000,
    \"limit\": 100,
    \"offset\": 0,
    \"hasMore\": true
  }
}
```

### GET /api/metrics/aggregated

ÏßëÍ≥ÑÎêú Î©îÌä∏Î¶≠ Îç∞Ïù¥ÌÑ∞Î•º Ï°∞ÌöåÌï©ÎãàÎã§.

**Query Parameters:**
- `metricName` (string, required): Î©îÌä∏Î¶≠ Ïù¥Î¶Ñ
- `period` (string, optional, default: hour): ÏßëÍ≥Ñ Îã®ÏúÑ (minute, hour, day)
- `startDate` (string, optional): ÏãúÏûë ÎÇ†Ïßú
- `endDate` (string, optional): Ï¢ÖÎ£å ÎÇ†Ïßú

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/metrics/aggregated?metricName=cpu_usage&period=hour\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"data\": [
    {
      \"period\": \"2024-01-15 10\",
      \"avg_value\": 72.3,
      \"min_value\": 45.2,
      \"max_value\": 89.1,
      \"count\": 120
    },
    {
      \"period\": \"2024-01-15 09\",
      \"avg_value\": 68.7,
      \"min_value\": 42.1,
      \"max_value\": 85.3,
      \"count\": 118
    }
  ]
}
```

### POST /api/produce/metric

ÏãúÏä§ÌÖú Î©îÌä∏Î¶≠ÏùÑ KafkaÎ°ú Ï†ÑÏÜ°Ìï©ÎãàÎã§.

**Request Body:**
```json
{
  \"metricName\": \"cpu_usage\",
  \"value\": 75.5,
  \"unit\": \"percentage\",
  \"tags\": {
    \"server\": \"web-01\",
    \"environment\": \"production\"
  }
}
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"success\": true,
  \"message\": \"Metric sent to Kafka\"
}
```

## üö® ÏóêÎü¨ Î°úÍ∑∏ API

### GET /api/errors

ÏóêÎü¨ Î°úÍ∑∏Î•º Ï°∞ÌöåÌï©ÎãàÎã§.

**Query Parameters:**
- `service` (string, optional): ÌäπÏ†ï ÏÑúÎπÑÏä§ ÌïÑÌÑ∞ÎßÅ
- `severity` (string, optional): Ïã¨Í∞ÅÎèÑ ÌïÑÌÑ∞ÎßÅ (error, warning, critical)
- `resolved` (boolean, optional): Ìï¥Í≤∞ ÏÉÅÌÉú ÌïÑÌÑ∞ÎßÅ
- `limit` (number, optional, default: 100): Ï°∞ÌöåÌï† Îç∞Ïù¥ÌÑ∞ Ïàò
- `offset` (number, optional, default: 0): ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Ïò§ÌîÑÏÖã

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/errors?service=api&severity=error&resolved=false\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"data\": [
    {
      \"id\": \"uuid-string\",
      \"service\": \"api\",
      \"errorType\": \"DatabaseConnectionError\",
      \"message\": \"Failed to connect to database\",
      \"stackTrace\": \"Error: Connection timeout\\n    at ...\",
      \"context\": {
        \"attempt\": 3,
        \"maxRetries\": 5
      },
      \"severity\": \"error\",
      \"resolved\": false,
      \"resolvedAt\": null,
      \"timestamp\": \"2024-01-15T10:30:00.000Z\",
      \"createdAt\": \"2024-01-15T10:30:01.000Z\"
    }
  ],
  \"pagination\": {
    \"total\": 25,
    \"limit\": 100,
    \"offset\": 0,
    \"hasMore\": false
  }
}
```

## üîß ÌÜ†ÌîΩ ÏÉÅÌÉú API

### GET /api/topics

Kafka ÌÜ†ÌîΩ ÏÉÅÌÉúÎ•º Ï°∞ÌöåÌï©ÎãàÎã§.

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/topics\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"data\": [
    {
      \"id\": \"uuid-string\",
      \"topicName\": \"user-activities\",
      \"partitionCount\": 3,
      \"replicationFactor\": 1,
      \"isActive\": true,
      \"lastMessageAt\": \"2024-01-15T10:30:00.000Z\",
      \"messageCount\": 15000,
      \"createdAt\": \"2024-01-15T08:00:00.000Z\",
      \"updatedAt\": \"2024-01-15T10:30:01.000Z\"
    }
  ]
}
```

## üìà ÌÜµÍ≥Ñ API

### GET /api/stats

Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú ÌÜµÍ≥ÑÎ•º Ï°∞ÌöåÌï©ÎãàÎã§.

**ÏòàÏãú ÏöîÏ≤≠:**
```bash
curl \"http://localhost:3000/api/stats\"
```

**ÏùëÎãµ ÏòàÏãú:**
```json
{
  \"stats\": {
    \"messages\": 50000,
    \"userActivities\": 12000,
    \"metrics\": 25000,
    \"errors\": 150,
    \"activeTopics\": 4
  },
  \"timestamp\": \"2024-01-15T10:30:00.000Z\"
}
```

## üîß HTTP ÏÉÅÌÉú ÏΩîÎìú

- `200` - ÏöîÏ≤≠ ÏÑ±Í≥µ
- `400` - ÏûòÎ™ªÎêú ÏöîÏ≤≠ (ÌïÑÏàò ÌååÎùºÎØ∏ÌÑ∞ ÎàÑÎùΩ Îì±)
- `404` - Î¶¨ÏÜåÏä§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå
- `500` - ÏÑúÎ≤Ñ ÎÇ¥Î∂Ä Ïò§Î•ò
- `503` - ÏÑúÎπÑÏä§ ÏÇ¨Ïö© Î∂àÍ∞Ä (Health Check Ïã§Ìå®)

## üìù ÏóêÎü¨ ÏùëÎãµ ÌòïÏãù

```json
{
  \"error\": \"Error message\",
  \"timestamp\": \"2024-01-15T10:30:00.000Z\",
  \"path\": \"/api/messages\"
}
```

## üîÑ ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò

Î™®Îì† Î™©Î°ù APIÎäî ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖòÏùÑ ÏßÄÏõêÌï©ÎãàÎã§:

- `limit`: Ìïú Î≤àÏóê Í∞ÄÏ†∏Ïò¨ Îç∞Ïù¥ÌÑ∞ Ïàò (Í∏∞Î≥∏Í∞í: 100, ÏµúÎåÄ: 1000)
- `offset`: Í±¥ÎÑàÎõ∏ Îç∞Ïù¥ÌÑ∞ Ïàò (Í∏∞Î≥∏Í∞í: 0)

**ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò ÏùëÎãµ:**
```json
{
  \"pagination\": {
    \"total\": 1500,
    \"limit\": 100,
    \"offset\": 0,
    \"hasMore\": true
  }
}
```

## üìä ÎÇ†Ïßú ÌïÑÌÑ∞ÎßÅ

ÎÇ†Ïßú ÌïÑÌÑ∞ÎßÅÏùÑ ÏßÄÏõêÌïòÎäî APIÏóêÏÑúÎäî ISO 8601 ÌòïÏãùÏùÑ ÏÇ¨Ïö©Ìï©ÎãàÎã§:

- `startDate`: `2024-01-15T00:00:00.000Z`
- `endDate`: `2024-01-15T23:59:59.999Z`

**ÏòàÏãú:**
```bash
curl \"http://localhost:3000/api/messages?startDate=2024-01-15T00:00:00.000Z&endDate=2024-01-15T23:59:59.999Z\"
```

## üöÄ ÏÇ¨Ïö© ÏòàÏãú

### JavaScript/TypeScript ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏

```typescript
class SMGKafkaClient {
  private baseURL = 'http://localhost:3000'

  async getUserActivities(params: {
    userId?: string
    action?: string
    limit?: number
    offset?: number
  }) {
    const query = new URLSearchParams()
    Object.entries(params).forEach(([key, value]) => {
      if (value !== undefined) query.append(key, value.toString())
    })

    const response = await fetch(`${this.baseURL}/api/user-activities?${query}`)
    return response.json()
  }

  async sendUserActivity(data: {
    userId: string
    action: string
    resource?: string
    metadata?: any
  }) {
    const response = await fetch(`${this.baseURL}/api/produce/user-activity`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    return response.json()
  }
}
```

### Python ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏

```python
import requests
from typing import Optional, Dict, Any

class SMGKafkaClient:
    def __init__(self, base_url: str = \"http://localhost:3000\"):
        self.base_url = base_url

    def get_user_activities(self, user_id: Optional[str] = None, 
                          action: Optional[str] = None,
                          limit: int = 100, offset: int = 0) -> Dict[str, Any]:
        params = {
            'limit': limit,
            'offset': offset
        }
        if user_id:
            params['userId'] = user_id
        if action:
            params['action'] = action
            
        response = requests.get(f\"{self.base_url}/api/user-activities\", params=params)
        return response.json()

    def send_user_activity(self, user_id: str, action: str, 
                         resource: Optional[str] = None,
                         metadata: Optional[Dict] = None) -> Dict[str, Any]:
        data = {
            'userId': user_id,
            'action': action
        }
        if resource:
            data['resource'] = resource
        if metadata:
            data['metadata'] = metadata
            
        response = requests.post(f\"{self.base_url}/api/produce/user-activity\", json=data)
        return response.json()
```